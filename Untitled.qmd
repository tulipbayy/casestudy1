---
title: ""
author: "Bayansulu Tulepbayeva and Alua Birgebayeva"
date: "Case Study 1: March 5, 2025"
format: 
  pdf:
    keep-tex: true
    include-in-header: 
       text: |
         \usepackage{fvextra}
         \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
         \DefineVerbatimEnvironment{OutputCode}{Verbatim}{breaklines,commandchars=\\\{\}}
    geometry: 
      - left=1in
      - right=1in
      - top=1in
      - bottom=1in
---

### Introduction


### Data & Methodology

We analyzed 67 Florida counties using data from the Sleuth2 package. Since Palm Beach County is suspected to be an outlier, we excluded it from our regression model to avoid bias.

To estimate how many votes Buchanan should have received in Palm Beach, we built a linear regression model predicting Buchanan votes based on Bush votes in the other counties. The equation of our model is:
```{r}
#| include: false

# Loading necessary packages
library(tidyverse)
library(Sleuth2)      # the package containing the data for the case study
library(kableExtra)   # for creating nicely formatted tables in Quarto

# Loading the case study data
election <- Sleuth2::ex0825

# Creating a second dataset with Palm Beach County excluded
election_wo_pb <- election |> filter(County != "Palm Beach")

```

### Regression Model 

```{r}
#| echo: false
#| message: false
#| warning: false

# Fit the linear model
model <- lm(Buchanan2000 ~ Bush2000, data = election_wo_pb)

# Display regression summary
summary(model)

```

```{r}
# Format and display the regression summary in a clean table
library(kableExtra)

# Extract regression coefficients
regression_table <- summary(model)$coefficients |> 
  kbl(col.names = c("Estimate", "Std. Error", "t value", "Pr(>|t|)"), 
      align = "c", booktabs = TRUE) |> 
  kable_classic(full_width = FALSE, latex_options = c("HOLD_position"))

# Show the table
regression_table

```

### Prediction for Palm Beach County 

```{r}
# Get Bush votes in Palm Beach County
pb_bush_votes <- election |> filter(County == "Palm Beach") |> pull(Bush2000)

# Predict Buchanan votes for Palm Beach (95% prediction interval)
predicted_pb_buchanan <- predict(model, newdata = data.frame(Bush2000 = pb_bush_votes), interval = "prediction", level = 0.95)

# Show the prediction interval
predicted_pb_buchanan

predicted_pb_df <- data.frame(
  County = "Palm Beach",
  Predicted_Buchanan_Votes = predicted_pb_buchanan[1],
  Lower_Bound = predicted_pb_buchanan[2],
  Upper_Bound = predicted_pb_buchanan[3]
)

predicted_pb_df |> 
  kbl(col.names = c("County", "Predicted Buchanan Votes", "Lower Bound (95% CI)", "Upper Bound (95% CI)"), 
      align = "c", booktabs = TRUE) |> 
  kable_classic(full_width = FALSE, latex_options = c("HOLD_position"))

```

### Actual vs. Predicted Votes & Miscast Estimate

```{r}
# Get actual Buchanan votes in Palm Beach
actual_pb_buchanan <- election |> filter(County == "Palm Beach") |> pull(Buchanan2000)

# Print actual Buchanan votes
actual_pb_buchanan

```

### Estimating the Midcast votes 

```{r}
# Estimate miscast votes (Actual Buchanan votes - Upper Bound of Prediction Interval)
miscast_votes <- actual_pb_buchanan - predicted_pb_buchanan[3]

# Print estimated miscast votes
miscast_votes

```
 
 
### Results 

```{r}
# Create a summary table for the report
miscast_summary_df <- data.frame(
  County = "Palm Beach",
  Actual_Buchanan_Votes = actual_pb_buchanan,
  Predicted_Upper_Bound = predicted_pb_buchanan[3],
  Estimated_Miscast_Votes = miscast_votes
)

# Display as a well-formatted table
library(kableExtra)
miscast_summary_df |> 
  kbl(col.names = c("County", "Actual Buchanan Votes", "Upper Bound Prediction", "Estimated Miscast Votes"), 
      align = "c", booktabs = TRUE) |> 
  kable_classic(full_width = FALSE, latex_options = c("HOLD_position"))

```


# R Appendix

_Copy and paste all code that you used for your case study into one chunk at the end of your written report. Before submitting your case study, take one final look at the R Appendix and make sure that all code is clearly visible. If you see a line running off the side of the PDF, please split the code over multiple lines using a linebreak. The header at the top of this template should ensure that lines of code are automatically wrapped in your final document._

```{r}
#| message: FALSE
#| warning: FALSE


```
